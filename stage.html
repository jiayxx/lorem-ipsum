<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stage â€“ Design Thinking Bootleg</title>
<style>
  :root {
    --bg:#f7faf9;
    --text:#1f2937;
    --muted:#6b7280;
    --surface:#fff;
    --border:#e5e7eb;
  }
  body {
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  main {padding:2rem;}
  h1 {margin:.25rem 0;font-size:1.8rem;}
  p {color:var(--muted);}
  .cards {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:1rem;
    margin-top:1rem;
  }
  .card {
    border:1px solid var(--border);
    border-radius:12px;
    background:var(--surface);
    padding:1rem;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    cursor:pointer;
  }
  .card h4 {margin:.2rem 0;}
  .tag {
    margin-top:1rem;
    font-size:.8rem;
    padding:.2rem .5rem;
    border-radius:8px;
    color:#fff;
    width:max-content;
  }
</style>
</head>
<body>
<main>
  <section class="stage">
    <h1 id="stage-title">Loading...</h1>
    <p id="stage-description">Please wait while we load stage details.</p>
  </section>

  <section class="stage">
    <h1>Methods in this Stage</h1>
    <div class="cards" id="methods-container"></div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const urlParams = new URLSearchParams(window.location.search);
const stageId = urlParams.get('id');

if (!stageId) {
  document.getElementById('stage-title').textContent = "Stage not found";
  document.getElementById('stage-description').textContent = "No stage ID provided in the URL.";
} else {
  // Load stage details
  axios.get('http://localhost/lorem%20ipsum/api/stages.php')
    .then(res => {
      const stages = res.data;
      const stage = stages.find(s => s.stage_id == stageId);
      if (stage) {
        document.getElementById('stage-title').textContent = stage.name;
        document.getElementById('stage-description').textContent = stage.description;
      }
    });

  // Load methods for this stage
  axios.get('http://localhost/lorem%20ipsum/api/methods.php?id=' + stageId)
    .then(res => {
      const methods = res.data;
      const container = document.getElementById('methods-container');
      container.innerHTML = "";

      if (!methods || methods.length === 0) {
        container.innerHTML = "<p>No methods available for this stage yet.</p>";
      } else {
        methods.forEach(m => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h4>${m.title}</h4>
            <p>${m.short_desc || ''}</p>
            <div class="tag" style="background:#3b82f6">Method</div>
          `;
          card.onclick = () => window.location.href = `method.html?id=${m.method_id}`;
          container.appendChild(card);
        });
      }
    })
    .catch(err => {
      console.error("Methods API error:", err);
      document.getElementById('methods-container').innerHTML = "<p>Error loading methods.</p>";
    });
}
</script>
</body>
</html>
